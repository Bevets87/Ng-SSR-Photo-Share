!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=require("tslib")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(4),r=n(5),a=n(7);o=s.createConnection(r.config.db_url),t.connection=o,t.database=new a.MySqlFacade(t.connection)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sql=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var o=[e[0]],s=0;s<t.length;s++)o.push(t[s],e[s+1]);return o.join("")}},function(e,t,n){"use strict";var o=this;Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),r=n(1);s.__awaiter(o,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,r.database.connect()];case 1:return e.sent(),[4,r.database.setup()];case 2:return e.sent(),[4,r.database.seed({users:100,tags:50})];case 3:return e.sent(),[4,r.database.disconnect()];case 4:return e.sent(),process.exit(0),[2]}})})},function(e,t){e.exports=require("mysql")},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),o=n(6).prodConfig,t.config=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prodConfig={port:process.env.PORT,base_url:process.env.BASE_URL,db_host:process.env.DB_HOST,db_password:process.env.DB_PASSWORD,db_user:process.env.DB_USER,db_database:process.env.DB_DATABASE,db_port:process.env.DB_PORT,db_url:process.env.JAWSDB_URL,session_secret:process.env.SESSION_SECRET,session_expiration:process.env.SESSION_EXPIRATION}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(8),r=n(9),a=n(10),E=function(){function e(e){this.connection=e}return e.prototype.dropTables=function(){return o.__awaiter(this,void 0,void 0,function(){var e=this;return o.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(r.drops().map(function(t){return e.query(t)}))];case 1:return t.sent(),[2]}})})},e.prototype.createTables=function(){return o.__awaiter(this,void 0,void 0,function(){var e=this;return o.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(r.creates().map(function(t){return e.query(t)}))];case 1:return t.sent(),[2]}})})},e.prototype.setup=function(){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(e){switch(e.label){case 0:return[4,this.dropTables()];case 1:return e.sent(),[4,this.createTables()];case 2:return e.sent(),[2]}})})},e.prototype.getConfig=function(){return{host:this.connection.config.host,port:this.connection.config.port,database:this.connection.config.database,password:this.connection.config.password,user:this.connection.config.user}},e.prototype.getState=function(){return this.connection.state},e.prototype.connect=function(){var e=this;return new Promise(function(t,n){e.connection.connect(function(o){o&&n(o);var r=e.connection.config.database+" connected to: "+e.connection.config.host;console.log(s.default.greenBright(r)),t(r)})})},e.prototype.disconnect=function(){var e=this;return new Promise(function(t,n){e.connection.end(function(o){o&&n(o);var r=e.connection.config.database+" disconnected from: "+e.connection.config.host;console.log(s.default.redBright(r)),t(r)})})},e.prototype.query=function(e,t){var n=this;return new Promise(function(o,r){n.connection.query(e,t,function(t,n){var a=e.split("(")[0];if(t)return console.error(s.default.bgRedBright(a)),r(t);o(n)})})},e.prototype.seed=function(e){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(t){switch(t.label){case 0:return[4,a.createSeed(e)];case 1:return t.sent(),[2]}})})},e}();t.MySqlFacade=E},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(2),r=s.sql(_||(_=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username CHAR(255) NOT NULL UNIQUE,\n    avatar CHAR(255),\n    password CHAR(255) NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW()\n  );\n"],["\nCREATE TABLE IF NOT EXISTS users (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    username CHAR(255) NOT NULL UNIQUE,\n    avatar CHAR(255),\n    password CHAR(255) NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW()\n  );\n"]))),a=s.sql(l||(l=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS photos (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    image_url CHAR(255) NOT NULL,\n    user_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE\n  );\n"],["\nCREATE TABLE IF NOT EXISTS photos (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    image_url CHAR(255) NOT NULL,\n    user_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE\n  );\n"]))),E=s.sql(d||(d=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS comments (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    comment_text TEXT NOT NULL,\n    photo_id INT NOT NULL,\n    user_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(photo_id) REFERENCES photos(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE\n  );\n"],["\nCREATE TABLE IF NOT EXISTS comments (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    comment_text TEXT NOT NULL,\n    photo_id INT NOT NULL,\n    user_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(photo_id) REFERENCES photos(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE\n  );\n"]))),i=s.sql(O||(O=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS likes (\n    user_id INT NOT NULL,\n    photo_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(photo_id) REFERENCES photos(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    PRIMARY KEY(user_id, photo_id)\n  );\n"],["\nCREATE TABLE IF NOT EXISTS likes (\n    user_id INT NOT NULL,\n    photo_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(photo_id) REFERENCES photos(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    PRIMARY KEY(user_id, photo_id)\n  );\n"]))),u=s.sql(N||(N=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS follows (\n    follower_id INT NOT NULL,\n    followee_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(follower_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(followee_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    PRIMARY KEY(follower_id, followee_id)\n  );\n"],["\nCREATE TABLE IF NOT EXISTS follows (\n    follower_id INT NOT NULL,\n    followee_id INT NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW(),\n    FOREIGN KEY(follower_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(followee_id) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    PRIMARY KEY(follower_id, followee_id)\n  );\n"]))),c=s.sql(m||(m=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS tags (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    tag_name CHAR(255) UNIQUE,\n    created_at TIMESTAMP DEFAULT NOW()\n  );\n"],["\nCREATE TABLE IF NOT EXISTS tags (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    tag_name CHAR(255) UNIQUE,\n    created_at TIMESTAMP DEFAULT NOW()\n  );\n"]))),T=s.sql(R||(R=o.__makeTemplateObject(["\nCREATE TABLE IF NOT EXISTS photo_tags (\n    tag_id INT NOT NULL,\n    photo_id INT NOT NULL,\n    FOREIGN KEY(tag_id) REFERENCES tags(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(photo_id) REFERENCES photos(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    PRIMARY KEY(tag_id, photo_id)\n  );\n"],["\nCREATE TABLE IF NOT EXISTS photo_tags (\n    tag_id INT NOT NULL,\n    photo_id INT NOT NULL,\n    FOREIGN KEY(tag_id) REFERENCES tags(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    FOREIGN KEY(photo_id) REFERENCES photos(id) ON DELETE CASCADE ON UPDATE CASCADE,\n    PRIMARY KEY(tag_id, photo_id)\n  );\n"])));t.creates=function(){return[r,a,E,i,u,c,T]};var _,l,d,O,N,m,R,p,f,I,S,h,C,A,L=s.sql(p||(p=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS users;\n"],["\nDROP TABLE IF EXISTS users;\n"]))),g=s.sql(f||(f=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS photos;\n"],["\nDROP TABLE IF EXISTS photos;\n"]))),F=s.sql(I||(I=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS comments;\n"],["\nDROP TABLE IF EXISTS comments;\n"]))),M=s.sql(S||(S=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS likes;\n"],["\nDROP TABLE IF EXISTS likes;\n"]))),b=s.sql(h||(h=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS follows;\n"],["\nDROP TABLE IF EXISTS follows;\n"]))),v=s.sql(C||(C=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS tags;\n"],["\nDROP TABLE IF EXISTS tags;\n"]))),k=s.sql(A||(A=o.__makeTemplateObject(["\nDROP TABLE IF EXISTS photo_tags;\n"],["\nDROP TABLE IF EXISTS photo_tags;\n"])));t.drops=function(){return[k,v,b,M,F,g,L]}},function(e,t,n){"use strict";var o=this;Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),r=n(11),a=n(12),E=n(13),i=n(14),u=n(15),c=n(16),T=n(17),_=n(18),l=n(19),d=function(e){return"https://picsum.photos/350/225?image="+e},O=function(e){var t=Math.floor(Math.random()*e.length);return e.splice(t,1)},N=function(e){var t=e.length;return e[Math.floor(Math.random()*t)]};t.createFakeUser=function(e){return[e,"test-"+e+"@test.com","password-"+e,r.internet.avatar()]},t.createFakePhoto=function(e,t){return[e,d(e),t]},t.createFakeComment=function(e,t,n){return[e,r.lorem.text(),t,n]},t.createFakeTag=function(e){return[e,r.lorem.word()+"-"+e]},t.createFakeUsers=function(e){for(var n=[],o=1;o<=e;)n.push(t.createFakeUser(o)),o++;return n},t.createFakePhotos=function(e){var n=[],o=1;return e.forEach(function(e){for(var s=e[0],r=N([0,2,5]);r>0;)n.push(t.createFakePhoto(o++,s)),r--}),n},t.createFakeComments=function(e,n){var o=[],s=1;return n.forEach(function(n){for(var r=n[2],a=e.filter(function(e){return e[0]!==r}),E=n[0],i=N([0,2,5,7]);i>0;){var u=O(a)[0][0];o.push(t.createFakeComment(s++,E,u)),i--}}),o},t.createFakeFollows=function(e){var t=[];return e.forEach(function(n){for(var o=n[0],s=e.filter(function(e){return e[0]!==o}),r=N([0,2,5]);r>0;){var a=O(s)[0][0];t.push([a,o]),r--}}),t},t.createFakeLikes=function(e,t){var n=[];return t.forEach(function(t){for(var o=t[2],s=e.filter(function(e){return e[0]!==o}),r=t[0],a=N([0,2,5]);a>0;){var E=O(s)[0][0];n.push([E,r]),a--}}),n},t.createFakeTags=function(e){for(var n=[],o=1;o<=e;)n.push(t.createFakeTag(o++));return n},t.createFakePhotoTags=function(e,t){var n=[];return t.forEach(function(t){for(var o=t[0],s=e.slice(),r=N([0,2,5]);r>0;){var a=O(s)[0][0];n.push([a,o]),r--}}),n},t.removeIds=function(e){return e.map(function(e){var t=e.slice();return t.splice(0,1),t})};var m=function(e){return e.map(function(e){var t=e.slice(),n=a.hashSync(t[2],10);return t.splice(2,1,n),t})};t.createSeed=function(e){var n=e.users,r=void 0===n?20:n,a=e.tags,d=void 0===a?20:a;return s.__awaiter(o,void 0,void 0,function(){var e,n,o,a,O,N,R,p;return s.__generator(this,function(s){switch(s.label){case 0:return r=r<10?10:r,d=d<10?10:d,e=t.createFakeUsers(r),n=t.createFakePhotos(e),o=t.createFakeComments(e,n),a=t.createFakeFollows(e),O=t.createFakeLikes(e,n),N=t.createFakeTags(d),R=t.createFakePhotoTags(N,n),p={users:t.removeIds(m(e)),photos:t.removeIds(n),follows:a,comments:t.removeIds(o),tags:t.removeIds(N),likes:O,photo_tags:R},[4,E.createManyUsers(p.users)];case 1:return s.sent(),[4,i.createManyPhotos(p.photos)];case 2:return s.sent(),[4,u.createManyComments(p.comments)];case 3:return s.sent(),[4,c.createManyLikes(p.likes)];case 4:return s.sent(),[4,T.createManyFollows(p.follows)];case 5:return s.sent(),[4,_.createManyTags(p.tags)];case 6:return s.sent(),[4,l.createManyPhotoTags(p.photo_tags)];case 7:return s.sent(),[2]}})})}},function(e,t){e.exports=require("faker")},function(e,t){e.exports=require("bcrypt")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s,r,a,E,i,u,c,T,_,l,d,O=n(0),N=n(2),m=n(1),R=function(){return function(){}}();t.User=R,t.getUserById=function(e){return m.database.query(N.sql(o||(o=O.__makeTemplateObject(["SELECT id, username, password, avatar FROM users WHERE id = ?"],["SELECT id, username, password, avatar FROM users WHERE id = ?"]))),[e]).then(function(e){return Promise.resolve(e[0])})},t.createUser=function(e){return m.database.query(N.sql(s||(s=O.__makeTemplateObject(["INSERT INTO users SET ?"],["INSERT INTO users SET ?"]))),e).then(function(e){return t.getUserById(e.insertId)})},t.createManyUsers=function(e){return m.database.query(N.sql(r||(r=O.__makeTemplateObject(["INSERT INTO users (username, password, avatar) VALUES ?"],["INSERT INTO users (username, password, avatar) VALUES ?"]))),[e])},t.deleteUser=function(e){return m.database.query(N.sql(a||(a=O.__makeTemplateObject(["DELETE FROM users WHERE users.id = ?"],["DELETE FROM users WHERE users.id = ?"]))),[e])},t.updateUser=function(e,t){return m.database.query(N.sql(E||(E=O.__makeTemplateObject(["UPDATE users SET username = ?, avatar = ? WHERE id = ?"],["UPDATE users SET username = ?, avatar = ? WHERE id = ?"]))),[t.username,t.avatar,e])},t.changeUserPassword=function(e,t){return m.database.query(N.sql(i||(i=O.__makeTemplateObject(["UPDATE users SET password = ? WHERE id = ?"],["UPDATE users SET password = ? WHERE id = ?"]))),[t,e])},t.getUserByUsername=function(e){return m.database.query(N.sql(u||(u=O.__makeTemplateObject(["SELECT id, username, password, avatar FROM users WHERE username = ?"],["SELECT id, username, password, avatar FROM users WHERE username = ?"]))),[e]).then(function(e){return Promise.resolve(e[0])})},t.getUsersNotInIds=function(e,t){void 0===t&&(t={limit:20,offset:0});return Promise.all([m.database.query(N.sql(T||(T=O.__makeTemplateObject(["\n    SELECT "," FROM users\n    WHERE users.id NOT IN (?)\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM users\n    WHERE users.id NOT IN (?)\n    LIMIT ? OFFSET ?\n  "])),"users.id, users.username, users.avatar "),[e,t.limit,t.offset]),m.database.query(N.sql(c||(c=O.__makeTemplateObject(["\n    SELECT COUNT(*) AS users_count FROM users WHERE users.id NOT IN (?)\n  "],["\n    SELECT COUNT(*) AS users_count FROM users WHERE users.id NOT IN (?)\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].users_count;return Promise.resolve({data:t,count:n})})},t.getUsersInIds=function(e,t){void 0===t&&(t={limit:20,offset:0});return Promise.all([m.database.query(N.sql(l||(l=O.__makeTemplateObject(["\n    SELECT "," FROM users\n    WHERE users.id IN (?)\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM users\n    WHERE users.id IN (?)\n    LIMIT ? OFFSET ?\n  "])),"users.id, users.username, users.avatar "),[e,t.limit,t.offset]),m.database.query(N.sql(_||(_=O.__makeTemplateObject(["\n    SELECT COUNT(*) AS users_count FROM users WHERE users.id IN (?)\n  "],["\n    SELECT COUNT(*) AS users_count FROM users WHERE users.id IN (?)\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].users_count;return Promise.resolve({data:t,count:n})})},t.searchUsersByUsername=function(e){var t=e.q.concat("%");return m.database.query(N.sql(d||(d=O.__makeTemplateObject(["\n    SELECT "," FROM users\n    WHERE LOWER(username) LIKE ?\n    LIMIT 20 OFFSET 0\n  "],["\n    SELECT "," FROM users\n    WHERE LOWER(username) LIKE ?\n    LIMIT 20 OFFSET 0\n  "])),"users.id, users.username, users.avatar "),[t])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(2),r=n(1),a=function(){return function(){}}();t.Photo=a;var E,i,u,c,T,_,l,d,O,N,m="photos.id, photos.image_url, photos.created_at, users.id AS user_id, users.username, users.avatar ";t.getPhotoById=function(e){return r.database.query(s.sql(E||(E=o.__makeTemplateObject(["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.id = ?\n    "],["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.id = ?\n    "])),m),[e]).then(function(e){return Promise.resolve(e[0])})},t.createManyPhotos=function(e){return r.database.query(s.sql(i||(i=o.__makeTemplateObject(["INSERT INTO photos (image_url, user_id) VALUES ?"],["INSERT INTO photos (image_url, user_id) VALUES ?"]))),[e])},t.createPhoto=function(e){return r.database.query(s.sql(u||(u=o.__makeTemplateObject(["INSERT INTO photos SET ?"],["INSERT INTO photos SET ?"]))),e).then(function(e){return t.getPhotoById(e.insertId)})},t.getPhotosInUserIds=function(e,t){void 0===t&&(t={limit:10,offset:0});return Promise.all([r.database.query(s.sql(T||(T=o.__makeTemplateObject(["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.user_id IN (?)\n    GROUP BY photos.id\n    ORDER BY photos.created_at DESC\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.user_id IN (?)\n    GROUP BY photos.id\n    ORDER BY photos.created_at DESC\n    LIMIT ? OFFSET ?\n  "])),m),[e,t.limit,t.offset]),r.database.query(s.sql(c||(c=o.__makeTemplateObject(["\n    SELECT COUNT(*) AS photos_count FROM photos\n     WHERE photos.user_id IN (?)\n  "],["\n    SELECT COUNT(*) AS photos_count FROM photos\n     WHERE photos.user_id IN (?)\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].photos_count;return Promise.resolve({data:t,count:n})})},t.getPhotosNotInUserIds=function(e,t){void 0===t&&(t={limit:10,offset:0});return Promise.all([r.database.query(s.sql(l||(l=o.__makeTemplateObject(["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.user_id NOT IN (?)\n    ORDER BY created_at DESC\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.user_id NOT IN (?)\n    ORDER BY created_at DESC\n    LIMIT ? OFFSET ?\n  "])),m),[e,t.limit,t.offset]),r.database.query(s.sql(_||(_=o.__makeTemplateObject(["\n    SELECT COUNT(*) AS photos_count FROM photos\n    WHERE photos.user_id NOT IN (?)\n  "],["\n    SELECT COUNT(*) AS photos_count FROM photos\n    WHERE photos.user_id NOT IN (?)\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].photos_count;return Promise.resolve({data:t,count:n})})},t.getPhotosByUserId=function(e,t){void 0===t&&(t={limit:10,offset:0});return Promise.all([r.database.query(s.sql(O||(O=o.__makeTemplateObject(["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.user_id = ?\n    ORDER BY created_at DESC\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM photos\n    INNER JOIN users ON photos.user_id = users.id\n    WHERE photos.user_id = ?\n    ORDER BY created_at DESC\n    LIMIT ? OFFSET ?\n  "])),m),[e,t.limit,t.offset]),r.database.query(s.sql(d||(d=o.__makeTemplateObject(["\n    SELECT COUNT(*) AS photos_count FROM photos\n    WHERE photos.user_id = ?\n  "],["\n    SELECT COUNT(*) AS photos_count FROM photos\n    WHERE photos.user_id = ?\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].photos_count;return Promise.resolve({data:t,count:n})})},t.deletePhoto=function(e,t){return r.database.query(s.sql(N||(N=o.__makeTemplateObject(["\n    DELETE FROM photos WHERE photos.id = ? AND photos.user_id = ?\n  "],["\n    DELETE FROM photos WHERE photos.id = ? AND photos.user_id = ?\n  "]))),[e,t])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s,r,a,E,i,u,c,T=n(0),_=n(2),l=n(1),d=function(){return function(){}}();t.Comment=d,t.getCommentById=function(e){return l.database.query(_.sql(o||(o=T.__makeTemplateObject(["\n    SELECT "," FROM comments\n    INNER JOIN users ON comments.user_id = users.id\n    WHERE comments.id = ?\n  "],["\n    SELECT "," FROM comments\n    INNER JOIN users ON comments.user_id = users.id\n    WHERE comments.id = ?\n  "])),"comments.id, comments.comment_text, users.username "),[e]).then(function(e){return Promise.resolve(e[0])})},t.getCommentsByPhotoId=function(e,t){void 0===t&&(t={limit:5,offset:0});return Promise.all([l.database.query(_.sql(r||(r=T.__makeTemplateObject(["\n    SELECT "," FROM comments\n    INNER JOIN users ON comments.user_id = users.id\n    WHERE comments.photo_id = ?\n    ORDER BY comments.created_at DESC\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM comments\n    INNER JOIN users ON comments.user_id = users.id\n    WHERE comments.photo_id = ?\n    ORDER BY comments.created_at DESC\n    LIMIT ? OFFSET ?\n  "])),"comments.id, comments.comment_text, users.username "),[e,t.limit,t.offset]),l.database.query(_.sql(s||(s=T.__makeTemplateObject(["\n    SELECT COUNT(*) AS comments_count FROM comments\n    WHERE comments.photo_id = ?\n  "],["\n    SELECT COUNT(*) AS comments_count FROM comments\n    WHERE comments.photo_id = ?\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].comments_count;return Promise.resolve({data:t,count:n})})},t.createComment=function(e){return l.database.query(_.sql(a||(a=T.__makeTemplateObject(["INSERT INTO comments SET ?"],["INSERT INTO comments SET ?"]))),e).then(function(e){return t.getCommentById(e.insertId)})},t.createManyComments=function(e){return l.database.query(_.sql(E||(E=T.__makeTemplateObject(["INSERT INTO comments (comment_text, photo_id, user_id) VALUES ?"],["INSERT INTO comments (comment_text, photo_id, user_id) VALUES ?"]))),[e])},t.deleteComment=function(e){return l.database.query(_.sql(i||(i=T.__makeTemplateObject(["DELETE FROM comments WHERE comments.id = ?"],["DELETE FROM comments WHERE comments.id = ?"]))),[e])},t.getCommentsCount=function(){return l.database.query(_.sql(u||(u=T.__makeTemplateObject(["SELECT COUNT(*) AS comments_count FROM comments"],["SELECT COUNT(*) AS comments_count FROM comments"])))).then(function(e){return Promise.resolve(e[0].comments_count)})},t.getCommentsCountByPhotoId=function(e){return l.database.query(_.sql(c||(c=T.__makeTemplateObject(["SELECT COUNT(*) AS comments_count FROM comments WHERE comments.photo_id = ?"],["SELECT COUNT(*) AS comments_count FROM comments WHERE comments.photo_id = ?"]))),[e]).then(function(e){return Promise.resolve(e[0].comments_count)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s,r,a,E,i,u,c,T,_,l=n(0),d=n(2),O=n(1),N=function(){return function(){}}();t.Like=N,t.getLikesByPhotoId=function(e,t){void 0===t&&(t={limit:20,offset:0});return Promise.all([O.database.query(d.sql(s||(s=l.__makeTemplateObject(["\n    SELECT "," FROM likes\n    INNER JOIN users ON likes.user_id = users.id\n    WHERE likes.photo_id = ?\n    ORDER BY likes.created_at\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM likes\n    INNER JOIN users ON likes.user_id = users.id\n    WHERE likes.photo_id = ?\n    ORDER BY likes.created_at\n    LIMIT ? OFFSET ?\n  "])),"users.id, users.username, users.avatar "),[e,t.limit,t.offset]),O.database.query(d.sql(o||(o=l.__makeTemplateObject(["\n    SELECT COUNT(*) AS likes_count FROM likes\n    WHERE likes.photo_id = ?\n  "],["\n    SELECT COUNT(*) AS likes_count FROM likes\n    WHERE likes.photo_id = ?\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].likes_count;return Promise.resolve({data:t,count:n})})},t.createLike=function(e){return O.database.query(d.sql(r||(r=l.__makeTemplateObject(["INSERT INTO likes SET ?"],["INSERT INTO likes SET ?"]))),e)},t.createManyLikes=function(e){return O.database.query(d.sql(a||(a=l.__makeTemplateObject(["INSERT INTO likes (user_id, photo_id) VALUES ?"],["INSERT INTO likes (user_id, photo_id) VALUES ?"]))),[e])},t.getLikesCount=function(){return O.database.query(d.sql(E||(E=l.__makeTemplateObject(["SELECT COUNT(*) AS likes_count FROM likes"],["SELECT COUNT(*) AS likes_count FROM likes"])))).then(function(e){return Promise.resolve(e[0].likes_count)})},t.getLikesCountByPhotoId=function(e){return O.database.query(d.sql(i||(i=l.__makeTemplateObject(["SELECT COUNT(*) AS likes_count FROM likes WHERE likes.photo_id = ?"],["SELECT COUNT(*) AS likes_count FROM likes WHERE likes.photo_id = ?"]))),[e]).then(function(e){return Promise.resolve(e[0].likes_count)})},t.getUserLikes=function(e,t){return O.database.query(d.sql(u||(u=l.__makeTemplateObject(["SELECT COUNT(*) AS likes_count FROM likes WHERE user_id = ? AND photo_id = ?"],["SELECT COUNT(*) AS likes_count FROM likes WHERE user_id = ? AND photo_id = ?"]))),[e,t]).then(function(e){return Promise.resolve(!!e[0].likes_count)})},t.removeLike=function(e,t){return O.database.query(d.sql(c||(c=l.__makeTemplateObject(["DELETE FROM likes WHERE user_id = ? AND photo_id = ?"],["DELETE FROM likes WHERE user_id = ? AND photo_id = ?"]))),[e,t])},t.getLikesByUserId=function(e,t){return Promise.all([O.database.query(d.sql(_||(_=l.__makeTemplateObject(["\n    SELECT "," FROM likes\n    INNER JOIN users ON likes.user_id = users.id\n    WHERE likes.user_id = ?\n    ORDER BY likes.created_at\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT "," FROM likes\n    INNER JOIN users ON likes.user_id = users.id\n    WHERE likes.user_id = ?\n    ORDER BY likes.created_at\n    LIMIT ? OFFSET ?\n  "])),"users.id, users.username, users.avatar, likes.photo_id"),[e,t.limit,t.offset]),O.database.query(d.sql(T||(T=l.__makeTemplateObject(["\n    SELECT COUNT(*) AS likes_count FROM likes\n    WHERE likes.photo_id = ?\n  "],["\n    SELECT COUNT(*) AS likes_count FROM likes\n    WHERE likes.photo_id = ?\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].likes_count;return Promise.resolve({data:t,count:n})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s,r,a,E,i,u,c,T=n(0),_=n(2),l=n(1),d=function(){return function(){}}();t.Follow=d,t.getAllFollowerIds=function(e){return l.database.query(_.sql(o||(o=T.__makeTemplateObject(["\n    SELECT follower_id FROM follows\n    WHERE followee_id = ?\n  "],["\n    SELECT follower_id FROM follows\n    WHERE followee_id = ?\n  "]))),[e]).then(function(e){return Promise.resolve(e.map(function(e){return e.follower_id}))})},t.getAllFolloweeIds=function(e){return l.database.query(_.sql(s||(s=T.__makeTemplateObject(["\n    SELECT followee_id FROM follows\n    WHERE follower_id = ?\n  "],["\n    SELECT followee_id FROM follows\n    WHERE follower_id = ?\n  "]))),[e]).then(function(e){return Promise.resolve(e.map(function(e){return e.followee_id}))})},t.createFollow=function(e){return l.database.query(_.sql(r||(r=T.__makeTemplateObject(["INSERT INTO follows SET ?"],["INSERT INTO follows SET ?"]))),e)},t.createManyFollows=function(e){return l.database.query(_.sql(a||(a=T.__makeTemplateObject(["INSERT INTO follows (follower_id, followee_id) VALUES ?"],["INSERT INTO follows (follower_id, followee_id) VALUES ?"]))),[e])},t.removeFollow=function(e,t){return l.database.query(_.sql(E||(E=T.__makeTemplateObject(["DELETE FROM follows WHERE follower_id = ? AND followee_id = ?"],["DELETE FROM follows WHERE follower_id = ? AND followee_id = ?"]))),[e,t])},t.getUserFollows=function(e,t){return l.database.query(_.sql(i||(i=T.__makeTemplateObject(["\n    SELECT COUNT(*) AS follows_count FROM follows\n    WHERE follower_id = ? AND followee_id = ?"],["\n    SELECT COUNT(*) AS follows_count FROM follows\n    WHERE follower_id = ? AND followee_id = ?"]))),[e,t]).then(function(e){return Promise.resolve(!!e[0].follows_count)})},t.getFollowersCount=function(e){return l.database.query(_.sql(u||(u=T.__makeTemplateObject(["\n    SELECT COUNT(*) AS followers_count FROM follows\n    WHERE followee_id = ?\n  "],["\n    SELECT COUNT(*) AS followers_count FROM follows\n    WHERE followee_id = ?\n  "]))),[e]).then(function(e){return Promise.resolve(e[0].followers_count)})},t.getFollowingCount=function(e){return l.database.query(_.sql(c||(c=T.__makeTemplateObject(["\n    SELECT COUNT(*) AS following_count FROM follows\n    WHERE follower_id = ?\n  "],["\n    SELECT COUNT(*) AS following_count FROM follows\n    WHERE follower_id = ?\n  "]))),[e]).then(function(e){return Promise.resolve(e[0].following_count)})}},function(e,t,n){"use strict";var o=this;Object.defineProperty(t,"__esModule",{value:!0});var s,r,a,E,i,u,c,T=n(0),_=n(2),l=n(1),d=function(){return function(){}}();t.Tag=d,t.getTagById=function(e){return l.database.query(_.sql(s||(s=T.__makeTemplateObject(["SELECT id, tag_name FROM tags WHERE id = ?"],["SELECT id, tag_name FROM tags WHERE id = ?"]))),[e]).then(function(e){return Promise.resolve(e[0])})},t.createTag=function(e){return l.database.query(_.sql(r||(r=T.__makeTemplateObject(["INSERT INTO tags SET ?"],["INSERT INTO tags SET ?"]))),e).then(function(e){return t.getTagById(e.insertId)})},t.createManyTags=function(e){return T.__awaiter(o,void 0,void 0,function(){return T.__generator(this,function(t){return[2,l.database.query(_.sql(a||(a=T.__makeTemplateObject(["INSERT INTO tags (tag_name) VALUES ?"],["INSERT INTO tags (tag_name) VALUES ?"]))),[e.map(function(e){return[e]})]).catch(function(){return Promise.resolve()})]})})},t._getDuplicates=function(e){return l.database.query(_.sql(E||(E=T.__makeTemplateObject(["SELECT tag_name FROM tags WHERE tags.tag_name IN (?)"],["SELECT tag_name FROM tags WHERE tags.tag_name IN (?)"]))),e).then(function(e){return Promise.resolve(e.reduce(function(e,t){return e[t.tag_name]=1,e},{}))})},t.deleteTag=function(e){return l.database.query(_.sql(i||(i=T.__makeTemplateObject(["DELETE FROM tags WHERE tags.id = ?"],["DELETE FROM tags WHERE tags.id = ?"]))),[e])},t.getTagsCount=function(){return l.database.query(_.sql(u||(u=T.__makeTemplateObject(["SELECT COUNT(*) AS tags_count FROM tags"],["SELECT COUNT(*) AS tags_count FROM tags"])))).then(function(e){var t=e[0].tags_count;return Promise.resolve(t)})},t.getTagByTagName=function(e){return l.database.query(_.sql(c||(c=T.__makeTemplateObject(["\n    SELECT tags.id, tags.tag_name FROM tags WHERE tags.tag_name = ?\n  "],["\n    SELECT tags.id, tags.tag_name FROM tags WHERE tags.tag_name = ?\n  "]))),[e])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s,r,a,E,i,u=n(0),c=n(2),T=n(1),_=function(){return function(){}}();t.PhotoTag=_,t.createPhotoTag=function(e){return T.database.query(c.sql(o||(o=u.__makeTemplateObject(["INSERT INTO photo_tags SET ?"],["INSERT INTO photo_tags SET ?"]))),e)},t.createManyPhotoTags=function(e){return T.database.query(c.sql(s||(s=u.__makeTemplateObject(["INSERT INTO photo_tags (tag_id, photo_id) VALUES ?"],["INSERT INTO photo_tags (tag_id, photo_id) VALUES ?"]))),[e])},t.getPhotoTagsByPhotoId=function(e){return T.database.query(c.sql(r||(r=u.__makeTemplateObject(["SELECT tags.id, tags.tag_name FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    WHERE photo_tags.photo_id = ?"],["SELECT tags.id, tags.tag_name FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    WHERE photo_tags.photo_id = ?"]))),[e])},t.searchTagsByTagname=function(e){var t=e.q.concat("%");return T.database.query(c.sql(a||(a=u.__makeTemplateObject(["\n    SELECT tags.id, tags.tag_name, COUNT(photos.id) AS posts FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    INNER JOIN photos ON photo_tags.photo_id = photos.id\n    WHERE tags.tag_name LIKE ?\n    GROUP BY tags.id\n    LIMIT 20 OFFSET 0\n  "],["\n    SELECT tags.id, tags.tag_name, COUNT(photos.id) AS posts FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    INNER JOIN photos ON photo_tags.photo_id = photos.id\n    WHERE tags.tag_name LIKE ?\n    GROUP BY tags.id\n    LIMIT 20 OFFSET 0\n  "]))),[t])},t.getPhotosByTagId=function(e,t){return Promise.all([T.database.query(c.sql(i||(i=u.__makeTemplateObject(["\n    SELECT tags.id, tags.tag_name, photos.id AS photo_id, photos.image_url, photos.user_id, photos.created_at FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    INNER JOIN photos ON photo_tags.photo_id = photos.id\n    WHERE tags.id = ?\n    GROUP BY photos.id\n    ORDER BY photos.created_at DESC\n    LIMIT ? OFFSET ?\n  "],["\n    SELECT tags.id, tags.tag_name, photos.id AS photo_id, photos.image_url, photos.user_id, photos.created_at FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    INNER JOIN photos ON photo_tags.photo_id = photos.id\n    WHERE tags.id = ?\n    GROUP BY photos.id\n    ORDER BY photos.created_at DESC\n    LIMIT ? OFFSET ?\n  "]))),[e,t.limit,t.offset]),T.database.query(c.sql(E||(E=u.__makeTemplateObject(["\n    SELECT COUNT(photos.id) AS photos_count FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    INNER JOIN photos ON photo_tags.photo_id = photos.id\n    WHERE tags.id = ?\n  "],["\n    SELECT COUNT(photos.id) AS photos_count FROM photo_tags\n    INNER JOIN tags ON photo_tags.tag_id = tags.id\n    INNER JOIN photos ON photo_tags.photo_id = photos.id\n    WHERE tags.id = ?\n  "]))),[e])]).then(function(e){var t=e[0],n=e[1][0].photos_count;return Promise.resolve({data:t,count:n})})}}]));